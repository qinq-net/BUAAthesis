% !Mode:: "TeX:UTF-8"
% vim: set foldmethod=marker sw=4 ts=4 noet:
\makeatletter
	\@namedef{ver@natbib}{opt@sort&compress}
\makeatother
\documentclass[bachelor,openany,oneside,color]{buaathesis}

% {{{ 导入宏包
\usepackage[backend=biber,style=gb7714-2015]{biblatex}
	\addbibresource[location=local]{QIN.bib}
\usepackage{tikz,amsmath,amssymb}% for common math symbols
	\usetikzlibrary{positioning,snakes}
%%\usepackage{gensymb}%other sumbles as \degree
\usepackage{booktabs}%for table \toprule and \bottomrule
\usepackage{physics}
\usepackage{bm}%for \bm{vector}
\usepackage{braket}%for \bra and \ket
%\usepackage{mathtools}%for correct \sum
\usepackage{commath}%for \abs
%\usepackage{mhchem} %for chemistry symbol \cm
\usepackage{mathrsfs}%for \mathscr characters
\usepackage{chngcntr,hyperref}%for hyperlink of reference
\usepackage{cleveref}
\usepackage{etoolbox}%for \ifcsdef
\usepackage{siunitx}%for units
	\DeclareSIUnit\year{a}
	\DeclareSIUnit\gauss{Gs}
\def\TZ{T\textsubscript{0}}

%\usepackage[top=1in, bottom=1in, left=1.25in, right=1.25in]{geometry}% page size
%\usepackage[font=small,width=0.8\textwidth,labelfont=bf]{caption}%for caption font
%\usepackage{subcaption} %for \subcaption{} for {subfigure}
%\usepackage{longtable}%for longer tables
%\usepackage{multirow}%for combined rows
%\usepackage{changepage}%for displaying page number
%\usepackage{fancyhdr}
%	\pagestyle{fancy}
%	\fancyhead{}
%	\fancyhead[RO,LE]{\thepage}
%	\fancyhead[LO,RE]{\SUBTITLE}
%	\fancyfoot{}
%	\renewcommand{\headrulewidth}{0pt}
%	\renewcommand{\footrulewidth}{0pt}

%\usepackage{autobreak,breqn}

%%=== ntheorem ===
%\usepackage[amsmath,thmmarks]{ntheorem}% for {theorem}
%	\theoremstyle{plain}
%	\theoremheaderfont{\normalfont\rmfamily\CJKfamily{hei}}
%	\theorembodyfont{\normalfont\rm\CJKfamily{kai}}
%	\theoremindent0em
%	\theoremseparator{\hspace{1em}}
%	\theoremnumbering{arabic}
%	\theoremsymbol{■}          %symbol added after end of theorem
%	\newtheorem{theorem}{Theorem}[subsection]
%	\newtheorem{defn}{Definition}[subsection]

%%=== lstlisting ===
%\usepackage{listings,color}
%	\definecolor{mygreen}{rgb}{0,0.6,0}
%	\definecolor{mygray}{rgb}{0.9,0.9,0.9}
%	\definecolor{mymauve}{rgb}{0.58,0,0.82}
%	\lstset{ %
%	  backgroundcolor=\color{mygray},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
%	%  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
%	  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
%	  breaklines=true,                 % sets automatic line breaking
%	  captionpos=b,                    % sets the caption-position to bottom
%	  commentstyle=\color{mygreen},    % comment style
%	  deletekeywords={...},            % if you want to delete keywords from the given language
%	  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
%	  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
%	  frame=single,	                   % adds a frame around the code
%	  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
%	  keywordstyle=\color{blue},       % keyword style
%	  language=Mathematica,                 % the language of the code
%	  morekeywords={*,...},           % if you want to add more keywords to the set
%	  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
%	  numbersep=5pt,                   % how far the line-numbers are from the code
%	  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
%	  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
%	  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
%	  showstringspaces=false,          % underline spaces within strings only
%	  showtabs=false,                  % show tabs within strings adding particular underscores
%	  stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
%	  stringstyle=\color{mymauve},     % string literal style
%	  tabsize=2,	                   % sets default tabsize to 2 spaces
%	  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
%	}

%% define math operators
\def\D{\mathrm{d}}
\def\Ln{\mathrm{ln}}
\def\CH{\mathrm{CH}}
\def\FWHM{\mathrm{FWHM}}
\def\figureinit{\centering\setlength\parindent{0pt}}
% }}}

\begin{document}

% {{{ 前缀部分
% 用户信息
\include{data/com_info}
\makeatletter
\hypersetup{
	pdftitle={\buaa@thesistitle},
	pdfauthor={\buaa@thesisauthor}
}
\makeatother
\include{data/bachelor/bachelor_info}

% 任务书信息
\include{data/bachelor/assign}

% 页眉页脚样式
\pagestyle{mainmatter}
% 封面、任务书、声明
\maketitle
% 摘要
\include{data/abstract}
% 目录
\tableofcontents

% 正文页码样式
\mainmatter
% }}}

%% 正文
\chapter{绪论}
% {{{ 绪论 

\section{课题背景}

在中高能粒子物理的实验研究中，对实验环境和探测器响应的模拟是实验准备阶段的一大核心
工作。根据这些模拟的结果，可以在实验准备阶段确定实验对不同探测器的性能提出的要求，
以评价和调整实验方案。目前，对粒子物理的模拟研究主要基于Geant 4模拟框架。该框架是一
套C++软件框架，提供了一套根据给定的物理过程列表追踪粒子及其次级粒子的工具。用户需要
使用C++语言编写或重载有关的类，以构建探测器、其数字化模块和场等其他环境因素。这种形
式意味着需要针对每个模拟问题构建一个新的模拟应用程序，并设计其数字化和数据存储与处
理的有关功能。

\section{国内外研究现状}

%%CEE
\subsection{CSR外靶实验（CEE）}

本研究所称的“HIRFL-CSR外靶实验”，指的是利用中科院近代物理研究所的重离子加速器提供的
束流进行重离子碰撞外靶实验（CSR External-target Experiment，CEE）。

该实验已经立项搭建低温高密核物质测量谱仪。该谱仪的测量手段为，利用大接收度的超导磁铁
，通过时间投影室、硅像素、高计数率飞行时间谱仪等多种国内首次采用的先进探测器，配合先
进的电子学技术，实现对中能重离子碰撞产物的全空间探测和鉴别。本研究的主要内容就是基于
CEE的设计构建软件层面的终端模拟和分析框架。

该实验将构建低温高密核物质测量谱仪，通过相对论重离子碰撞实验实现QCD相变。国际上已经
有多个类似的重离子碰撞实验，但基本运行在高能区。
\begin{itemize}
	\item 美国的相对论重离子对撞机（RHIC），每对核子对撞能量达\SI{200}{\giga\eV}；
	\item 欧洲核子中心的大型强子对撞机（LHC），能量可达\SI{5.4}{\tera\eV}，以寻找
		高温夸克胶子等离子体并探索其性质；
	\item 德国的反质子-离子研究装置（FAIR）上将要运行的压缩强子物质实验（CBM），
		每核子能量达\SI{45}{\giga\eV}，主要目的是探索高密QCD相变和临界点。
\end{itemize}
国际上已有的重离子碰撞实验鲜有涉及低温而更高重子化学势（重子数密度）的区域，这一区
域恰好是HIRFL-CSR和将来HIAF装置将覆盖的区域。RIEFL-CSR能够提供$0.5\sim\SI{1.2}
	{\giga\eV}$的离子束流，QCD相图在这一区域有非常丰富的结构和与恒星演化密切相关的
状态方程信息。

%%GSI
\subsection{终端模拟和分析框架}

终端模拟和分析框架指的是构建一套软件框架，对探测器进行构建、模拟和数字化（digitize，
指将模拟中探测器灵敏的物理量转换为读出系统的实际输出）。核物理与高能物理领域内常用到
模拟框架Geant 4与分析框架ROOT。Geant 4需要为每个模拟问题专门编写程序，构建探测器并存
储所需的物理信息；ROOT主要用于对数据的统计分析。

以上述德国的FAIR装置为例，GSI开发了一套面向对象的模拟、重建和数据分析框架FairRoot。
该框架下可以将每个探测器构建为由数字化参数构建、几何参数构建、蒙特卡洛模拟等若干个
类组成的类库，还可以实现粒子轨迹的可视化等针对整个外靶实验的功能。FAIR上正在筹备的
CBM实验基于该框架构建了数据分析软件CbmRoot，其中构建了其中用到的各探测器及其布局，
能够对整个实验进行模拟、重建和事件显示等。

\section{课题目的}

本研究的主要目的是基于HIRFL-CSR外靶实验的设计和实际情况，构建终端模拟和分析框架。
经过调研，构建框架至少需要完成以下的工作。
\begin{enumerate}
	\item 构建探测器：对每种类型的探测器都至少需要完成以下工作：
	\begin{enumerate}
		\item 读取探测器的几何参数，构建探测器的几何形态；
		\item 读取和构建探测器的材料信息；
		\item 设计各种探测器的数字化模块，基于探测器的工作原理给出读出系统的输出；
	\end{enumerate}
		以实现对探测器主要功能的模拟。
	\item 基于HIRFL-CSR的实际情况，构建粒子源和物理列表；
	\item 基于外靶实验的设计，构建实验环境的电磁场等因素；
	\item 调用以上构建出来的框架，实现对整个实验的模拟、数字化和重建等功能；
	\item 调用分析框架提供的显示功能，实现对事件进行可视化的功能。
\end{enumerate}

\section{论文构成及研究过程}

\subsection{论文构成}

本论文将主要围绕CEE实验概况、模拟框架的主体结构、关键技术难点的实现和模拟样例与分析
四部分展开。其中，实验概况将介绍CEE实验的物理目标、计划选用的探测器类型与功能，以及
实验的探测器布局等信息，以作为本文的构建基础；主体结构将介绍本框架所划分的主要模块及
其功能；关键技术难点将介绍MRPC、TPC和MWDC三种探测器的数字化实现原理，以及径迹重建的
基本原理。

\subsection{研究过程}

本研究主要围绕Geant 4框架的学习和对探测器原理的学习逐渐展开，工作过程大致可以分为以
下的几个阶段。
\begin{enumerate}
	\item 1--2月：调研模拟框架的原理，学习基础知识；
	\item 3月：实现简单的几何构建，实现粒子源、物理列表和材料构建；
	\item 4月：完成几何构建，实现简单的数字化模块；
	\item 5月：实现关键探测器的数字化功能，分析输出结果。
\end{enumerate}
% }}}

\chapter{CEE实验概况}
% {{{ CEE实验概况 

本框架的设计目标是对CEE的探测器系统进行构建和模拟，并准备用于CEE实验的分析；本章将
介绍CEE实验的主要物理目标、需要在框架内给出构建的主要子系统，以及整个探测器系统的
概览图。

\section{物理目标}

CSR外靶实验（CEE）的探测器系统被称作“低温高密核物质测量谱仪”，这一谱仪将是我国
第一台运行于\si{\giga\eV}能区的、完全自主研制的、基于国内核物理大科学装置
HIRFL-CSR的大型核物理实验装置。其主要的科学功能是实现该能区的重离子碰撞中带电粒子
产物的近全空间测量，为致密天体性质、核反应动力学、自旋和同位旋相关的核力与
核物质状态方程性质、高重子数密度QCD相图等重要的科学问题研究提供基础实验数据。
\cite{技术文档}

CEE实验

\section{主要子系统}

CEE的主要子系统包括磁场、探测器系统、读出系统与靶。其中，探测器系统主要包括
微像素定位探测器、径迹探测器、飞行时间探测器（TOF）和零度角量能器（ZDC）这四类。
本节将介绍磁场系统，以及各类探测器的用途、原理和CEE中采用探测器的设计要点。

\subsection{磁场系统}

CEE的磁场系统主要是一个由超导二极磁铁产生的在
$\SI{1}{\meter}\times\SI{0.9}{\meter}\times\SI{1.2}{\meter}$（长、高、宽）
的大范围内保持高均匀度的磁场，中心区域场强控制为\SI{0.5}{\tesla}。
该磁场的主要功能是偏转带电粒子，使带电粒子在磁场内的径迹探测器中产生偏转径迹，利用
探测到的重建径迹得到粒子的动量。最简单的情况是对非相对论粒子（如重离子），忽略粒子
穿过探测器通过电离等形式发生的能量损失、忽略竖直方向电场等作用的情况，并假定磁场
方向与运动平面垂直时，可以认为其所受的洛伦兹力$\bm{F}$提供偏转向心力：
\begin{equation}
\bm{F} = -\frac{mv^2}{R}\hat{\bm{n}} = q\bm{v}\times\bm{B}
\end{equation}
其中$m$为粒子质量，$\bm{v}$为速度，$R$为偏转半径，$\hat{\bm{n}}$为径向单位矢量，
$\bm{B}$为磁场的磁感应强度；于是有
\begin{equation}
p = q B R
\end{equation}
其中$p$为粒子动量大小。因此，在重建得到半径的情况下，可以确定已知电荷量粒子的动量。

CEE所用的磁场本质上是服务于径迹探测器中的时间投影室探测器（Time Projection Chamber,
TPC）的，因此其可以被简化为覆盖一个包覆了TPC探测器的固定尺寸的长方体范围的
局域匀强磁场。

\subsection{微像素定位探测器}\label{ssec:det:track}

微像素定位探测器主要用于提供束流的入射方向以及对发生反应的顶点位置进行精密测量。
这一探测器相当于对束流的主要参数进行限定。在本框架内，这一探测器的功能可以由对
粒子源参数的控制实现。

\subsection{径迹探测器}

径迹探测器的主要用途是获取粒子径迹，从而得到粒子动量和进行粒子甄别。CEE实验中采用
的径迹探测器主要有时间投影室（Time Projection Chamber, TPC）和
多丝漂移室（MWDC）。

\subsubsection{时间投影室（TPC）}

TPC探测器的主要原理是在气体漂移室探测器中加以匀强电场，使入射粒子在灵敏区内产生的
带电次级粒子受到的电场力与气体内的阻力平衡，从而使次级粒子沿电场方向做匀速运动，
以将粒子在电场方向的径迹位置投影为漂移时间；在垂直电场方向的平面上设置空间灵敏的
GEM雪崩放大及感应阵列探测次级粒子（时间信息来自漂移速度快的电子），从而得到垂直
电场方向的位置信息。一般为了简化探测器结构，磁场和电场在同一方向上。例如，假设
次级粒子在漂移室内运动所受阻力为$\bm{F}_\nu=-\alpha\bm{v}$（$\alpha$为阻力系数，
$\bm{v}$为粒子速度），平衡状态下粒子运动方向应当与电场方向平行，并满足电场力与
阻力平衡：
\begin{equation}\label{eq:det:TPC:eq}
	\bm{F}_\nu+q\bm{E}=-\alpha\bm{v}+q\bm{E}=0
\end{equation}
其中$q$为次级粒子所带电荷；$\bm{E}$为TPC内的匀强电场。因此，对于一定的粒子（具有
确定的阻力系数和电荷量），其漂移速度是一个定值。

本质上，TPC探测器可以视为一个主要对时间和位置灵敏的探测器；应当可以读出粒子在TPC
中划过径迹的位置，在垂直于电场的方向上划分为若干灵敏块（按照各个读出单元的
灵敏范围），并记录每个灵敏块的能量沉积漂移时间。

\subsubsection{多丝漂移室（MWDC）}

CEE中采用的多丝漂移室系统由六块MWDC组成，分别配置在上述磁铁下游方向的束流线两侧，
每侧分别平行放置三块；每块MWDC由三层成角度的灵敏丝层组成。当粒子穿过MWDC时，在
每块MWDC内可以在三层灵敏丝上分别产生打火信号，从而确定穿过点的位置并评判其可信度。

这一MWDC系统可以抽象为一个空间灵敏探测器，可以分为等厚度的三层，在每层能够记录
打火信号的一维位置信息。

\subsection{飞行时间探测器}

CEE实验拟采用的飞行时间探测器均为多层MRPC阵列，主要包括磁场外部、束流线下游的
端盖飞行时间探测器（eTOF），磁铁轭铁与TPC之间的内部飞行时间探测器（iTOF）和
起始时间探测器（\TZ）。

这些飞行时间探测器的本质均为多层MRPC阵列，可以抽象为对时间和位置灵敏的探测器，
可以为每组输出起始时间和信号到达两端的时间差（反映一维位置信息）。

\subsection{零度角量能器（ZDC）}

ZDC位于探测器系统的最后，可以接收到受磁场偏转影响较小的强子。该量能器的基本结构
为铅和闪烁体夹层，可以读出事件沉积的总能量。

\section{实验布局}

CEE拟利用粒子在磁场中的偏转，通过测量粒子的径迹和飞行时间实现对粒子动量的重建
和种类鉴别。\cite{技术文档}CEE谱仪的核心部件为大接收度的二极磁铁与置于磁场内的
实现三维测量的TPC；为处理束流附近的死区，磁场下游方向束流两侧布置有两组MWDC
阵列；为实现轻粒子甄别，在TPC外和MWDC后设置有以MRPC阵列组成的飞行时间探测器
（TOF）和时间起始探测器\TZ；最后设置有零度角量能器ZDC。整体构型如图
\ref{fig:CEE:Subsystem}所示。

\begin{figure}\centering
	\includegraphics[width=0.9\textwidth]{./resource/CEE-Subsystem.png}
	\captionsetup{width=0.9\textwidth}
	\caption{CEE各子系统示意图。包括：SC-Dipole：超导二极磁铁；
		SiPiX：硅像素定位探测器；\TZ：起始时间探测器；TPC：中心时间投影室；
		iTOF：内飞行时间探测器；eTOF，端盖飞行时间探测器；
		MWDC：前角多丝漂移室径迹探测器；ZDC：零度角量能器}
	\label{fig:CEE:Subsystem}
\end{figure}

% }}}

\chapter{模拟框架的主体结构}
% {{{ 模拟框架的主体结构

本研究构建的模拟与分析框架目前主体是一个基于Geant4的C++应用程序，其中构建了所需的
探测器、与模拟有关的物理信息和数字化模块。其中，每个探测器都拥有自己的一套几何构建
与数字化模块，从而实现了每个探测器的模块化。

为了实现模拟，Geant4应用程序至少需要构建的功能主要包括探测器（以及其他环境几何体）
构建、主粒子生成（粒子源构建）和物理过程定义（物理列表）。为了将模拟结果转换为便于
分析的格式，还需要利用分步操作等功能对模拟过程中的部分物理量进行记录。以下将分各
模块介绍本框架所采用的各个模块的基本结构与功能。

\section{几何构建}

Geant4中的探测器构建类主要需要提供Construct（几何构建）与ConstructSDandField（灵敏
探测器与场的构建）两个主要的虚函数。本框架提供了这两个函数，分别用于构建探测器几何
结构与探测器的数字化功能。

几何构建方面，本框架为每一种探测器各提供了一个类，在类的构建函数中由外向内分别构建
了各种探测器的不同部分（如外壳、灵敏区等），最终给出整个探测器的逻辑体积（Logical
Volume）。这一过程中，构建函数将会从纯文本格式的数据文件中读取各个探测器组成部分
的尺寸信息。最终，探测器类将存有一个除了最终的摆放位置外全部构建完成的探测器，以及
从数据文件中读取的探测器摆放信息；该类最终在Construct函数中被实例化，并利用逻辑体积
和摆放位置生成其物理体积（Physical Volume）。各类还提供了一个函数GetSensitiveLVs，
返回所有灵敏区的逻辑体积列表，以方便数字化过程中判断粒子是否进入了灵敏区。

\TZ、iTOF和eTOF等飞行时间探测器在构建时，探测器均被视为MRPC阵列，构建时先构建整个
探测器，然后是各个单元探测器，之后是各单元探测器内的各个MRPC，最后是各MRPC内的每一层
玻璃；由于读出时所用的读出层（PCB板）和有关的电路对高能离子的径迹影响有限，因此没有
构建。

TPC探测器的灵敏区被视为一个盒子，其精细结构没有构建。

\section{材料模块}

为存取各探测器和其他几何体的材料信息，本框架提供了一个材料库类，并在其中构建了
探测器所需的各种材料。其中包括部分探测器灵敏区所使用的混合气体。
%%还需要更多信息

\section{电磁场模块}

本框架目前还没有设置针对全局的电磁场模块。目前框架中涉及的电磁场构建主要为对TPC
探测器构建的局域匀强磁场。TPC探测器中所涉及的电场对高能离子径迹影响有限，因此没有
构建。

\section{数字化模块}

本框架的数字化功能主要基于Geant4提供的灵敏探测器功能；该功能会探测每个模拟步骤
是否从灵敏区域内出发（PreStepPoint是否位于灵敏探测器内）；判断成功时会调用有关的
ProcessHits函数，以构建一个Hit来存储事件的有关信息。

本框架为每种探测器构建了继承Geant4提供的多功能探测器类的类，称作该探测器的数字化
模块。这种“多功能探测器”可以将若干“原始量记录器”对象存储在其中，对于不同的物理量
记录需求只需要引入不同的记录器，从而可以将不同物理量的记录分开，实现探测器功能的
模块化。本框架为实现不同探测器的功能，采用了Geant4提供的能量沉积记录器，并实现了
起始时间、灵敏区Step记录、TPC的分道记录、MRPC的分块记录和MWDC的分层记录，以模拟
各个探测器不同的读出方式。

在ConstructSDandField函数中构建灵敏探测器时，本框架首先为每个探测器实例化了其
灵敏探测器类，在其构建函数中注册了以上实现的对应记录：其中，TPC注册了Step记录和
专门实现的TPC记录（本模块将在第\ref{ssec:digi:TPC}节中介绍）；\TZ、eTOF、iTOF
等时间灵敏探测器注册了起始时间和MRPC记录（见第\ref{ssec:digi:MRPC}节）；MWDC
注册了Step记录和MWDC记录（见第\ref{ssec:digi:MWDC}节）。随后，从几何构建模块
调用GetSensitiveLVs函数取得了灵敏区的逻辑体积，并将对应的探测器绑定给了各个
探测器的灵敏区。由于本框架内没有利用一个逻辑体积重复创建多个几何体，因此所有
探测器模块均有各自的灵敏探测器实例。

以上的数字化模块将会将记录的信息分别存储在各个记录器创建的HitsMap对象中：该对象
实质上保存有一个以逻辑体积所创建出的物理体积的编号为键值的std::map字典对象，可以
为从逻辑体积中创建出的每个探测器（在本框架中仅一个）存储一个保存有事件信息的
对象。本框架中为MWDC、TPC和MRPC分别提供了不同的时间信息对象，其基本结构均为一个
以读出模块的编号为键值的std::map字典对象，为每个读出模块存储一个存有起始时间、
能量沉积、漂移时间等信息的结构体。这些HitsMap将被数字化模块存入Geant4运行时的
HitsCollection数据库中，并可以在事件结束或运行结束后调用读出；也可以直接通过
调用本框架实现的记录器所提供的PrintAll函数进行数据输出。

为了读出模拟信息用于下一步的数据分析，本框架在每个Event结束的操作函数
EndOfEventAction中调用了各个探测器的各个记录器的PrintAll函数，将各个探测器收集
到的信息输出到了纯文本文件中，以用于对数字化结果的评价和进一步的分析。

\section{粒子源与物理列表}

本框架目前采用一个\SI{250}{\MeV/u}的全剥离C-12离子作为粒子源。

为满足离子跟踪的需求，本框架目前采用Geant4提供的QGSP\_BIC作为物理列表。
% }}}

\chapter{关键问题分析或实现}
% {{{ 关键技术难点 

本框架的构建中，主要的技术难点在于对TPC、MRPC和MWDC三种原理和结构较为复杂的
探测器模块的数字化实现。同时，在探测器内及探测器间的粒子径迹重建将会是本框架
分析功能的主要难点和核心功能。

\section{关键探测器的数字化实现}

本框架基于对TPC、MRPC和MWDC三种探测器模块的原理分析，充分利用Geant4等框架提供
的方法，实现了对这三种探测器的数字化。

\subsection{TPC记录}\label{ssec:digi:TPC}

CEE所采用的TPC的基本原理已经在第\ref{ssec:det:track}节中得到介绍。在本框架中，
TPC被简化为一个对空间和时间灵敏的探测器。以下是本框架中构建的TPC的主要原理和
实现思路。

\begin{figure}
	\centering
	\includegraphics[width=0.6\textwidth]{./resource/CEE-TPC-Overview.png}
	\caption{TPC结构示意图：下部为阴极，上部为阳极，四周围以加有阶梯电压的
		金属条（红蓝的条状物）；内部为灵敏区}
	\label{fig:det:TPC:Overview}
\end{figure}

CEE采用的TPC的结构如图\ref{fig:det:TPC:Overview}所示，上部为读出板。读出板
下方设置有一个大面积GEM膜，可以对漂移到TPC顶部的电子进行雪崩放大。读出板上
设置有12000个读出单元\cite{技术文档}，带电粒子
进入TPC后，其在灵敏区内产生的次级粒子将被竖直方向在读出板上投影位置的
读出单元感应到，从而由其在读出板上的投影给出其在水平平面内的位置信息；
利用式\ref{eq:det:TPC:eq}，次级粒子（电子）在TPC内近似以匀速运动，其飞行时间
（从电离到飞行至GEM被记录板感应到的飞行时间）被用于确定事件在竖直方向的位置。

在本框架中，这一过程被抽象为：首先将探测器按照读出板上的读出单元分成若干个小室，
每个小室对应一个读出单元的灵敏区；粒子进入TPC时，在每个小室内产生的总能量损失和
发生事件的位置与时间会被记录。这里与上述原理主要的区别是本框架内为了提高模拟效率，
只构建了TPC内的磁场，而暂时还没有构建TPC内的电场，也没有模拟电子真实的漂移过程
或在GEM上的雪崩放大；因此，我们假设电离产生的次级电子会在TPC内短时间内减速而
失去其初始动能（从而忽略减速过程中所受的电场作用），随后受到电场力作用匀速到达
GEM膜而被放大和被探测到；
%TODO：考虑复合
其中，目前本框架尚未考虑这两个过程中被复合而损失的电子，
因此本框架记录和存储的是所有终止在TPC内的电子的位置和时间信息。

事实上，由于TPC中所有次级电子最终都是匀速飞向记录板的，因此TPC并不对康普顿效应、
各种热效应等不产生次级电子的能量损失敏感，而是只对次级电子的产生敏感；因此，
本框架在完成TPC的数字化过程时，可以认为TPC的输出结果就是每个记录单元所应当
感应到的电子数目和触发该记录单元的时间。目前本框架在每个模拟事件结束时，
将这些电子归入设定好的小室，确定每个次级电子将会被哪个或哪些记录单元记录到；
最后输出每个记录单元所应当记录到的电子个数和触发时间。
%TODO：考虑死时间
这一过程中，本框架暂时没有考虑记录板的死时间问题，因此记录下来的是飞行到GEM膜
的总电子数目；
%TODO：Y坐标与时间的关系
尽管次级电子在TPC内匀速运动，但具体的竖直方向坐标与漂移时间的关系还需要实验
定标，本框架目前近似认为感应到信号所花的时间就是电子以一定的漂移速度
\SI{5}{\centi\meter/\micro\second}飞行到GEM膜的时间。

本框架的TPC记录器将模拟得到的数据存储在一个以各个电子的跟踪编号（TrackID）为
键值的字典对象中，为每个键值存储其最后一次被跟踪时的位置和时间；飞出TPC的
电子对应的记录将被清除，因为其将无法在TPC中受到电场作用而飞向GEM膜，从而不会
被TPC感应到；相反，在TPC外电离产生而飞入TPC的电子将会被记录。本框架的输出系统
会在每次事件结束时先输出各个次级电子的跟踪信息（编号、最后位置和时间），再输出
每个读出单元所应当读到的电子数目与触发时间。

\subsection{MRPC记录}\label{ssec:digi:MRPC}
\subsection{MWDC记录}\label{ssec:digi:MWDC}

\section{径迹重建的基本原理}

% }}}

\chapter{模拟样例与分析}
% {{{ 模拟样例与分析
% }}}

\chapter*{结论}

% {{{ 结论
% }}}

% 致谢
\include{data/bachelor/acknowledgement}
% 参考文献
%\include{data/reference}
\printbibliography[heading=bibintoc,title={参考文献}]

% 附录
\appendix
%\include{data/appendix1-faq}
%\include{data/appendix2-contactus}
\end{document}
